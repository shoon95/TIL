# 2024-01-05

## 네트워크

### NAT/PAT

### DNS

> 도메인 주소를 IP주소로 변환하는 역할

* 네트워크 프로토컬
  * 데이터 프로토콜
  * 컨트롤 프로토콜 : 통신에 직접 관여하지 않지만 처음 통신 관계를 맺거나 유지하는데 역할을 함
    * ARP, ICMP, DNS

#### DNS란

* 사이트에 접속하거나 링크에 지정된 주소
  * http://202.179.177.21 (ip 주소)
  * http://naver.com (도메인 주소)

* 문자열로 구성된 주소가 외우기 쉬움

* IP가 변경되어도 도메인 주소를 사용하면 접속 방법 변경 없이 서비스 이용 가능

* 흐름

  1. 사용자가 도메인 주소를 활용하여 www.naver.com 서비스 요청
  2. 네트워크 설정에 입력한 DNS로 해당 도메인에 대한 IP 주소 질의를 보냄
  3. 요청한 도메인의 서비스 IP 주소 받음

  > 사용자가 웹 브라우저에 naver.com을 입력하면 DNS 서버에서 naver.com 주소가 무엇인지 질의하고 DNS 서버는 naver.com의 IP 주소가 202.179.177.21이라고 사용자에게 알려줌. 이후 사용자는 DNS로 응답받은 202.179.177.21이라는 IP주소를 이용해 실제 naver.com에 접속

### DNS 서버의 구조와 명명 규칙

* 역트리 구조

  > www.naver.com.

  * root : .
  * Top-Level : com
  * Second-Level : naver
  * Thrid-Level www

* 루트 도메인

  * 도메인을 구성하는 최상위 영역
  * DNS 서버는 사용자가 쿼리한 도메인에 대한 값을 직접 갖고 있거나 캐시에 저장된 정보를 이용해 응답
  * DNS 서버에 해당 도메인 정보가 없으면 루트 DNS에 쿼리

* Top-Level Domain(TLD)

  > TLD는 IANA(Internet Assigned Numbers Authority)에서 구분한 6가지 유형으로 구분

  * Generic(gTLD)
    * 특별한 제한 없이 일반적으로 사용되는 최상위 도메인
    * 세 글자 이상으로 구성
      * com : 일반 기업체
      * edu : 4년제 이상 교육기관
      * gov : 미국 연방정부기관
      * int : 국제기구, 기관
      * mil : 미국 연방군사기관
      * net : 네트워크 관련 기관
      * org : 비영리기관
  * country-code(ccTLD) 
    * 국가 최상위 도메인
    * ISO 3166 표준에 의해 규정된 두 글자의 국가 코드 사용 (우리나라 : kr)
  * sponsored(sTLD)
    * 특정 목적을 위한 스폰서를 두고 있는 최상위 도메인
      * 특정 민족공동체, 전문가 집단, 지리적 위치 등
      * ['.aero', '.asia', '.edu', '.museum']
  * infrastructure
    * 운용상 중요한 인프라 식별자 공간을 지원하기 위해 전용으로 사용되는 최상위 도메인
  * generic-restricted(grTLD)
    * 특정 기준을 충족하는 사람이나 단체가 사용할 수 있는 최상위 도메인
  * test(tTLD)
    * 개발 프로세스에서 테스트 목적으로 사용하는 최상위 도메인

### DNS 동장 방식

* hosts 파일 : 도메인과 IP 주소를 설정해두면 해당 도메인 리스트는 항상 DNS 캐시에 저장

  1. 도메인 쿼리
  2. DNS 캐시 정보 확인
  3. 캐시에 없다면 DNS 서버로 쿼리 수행
  4. 결과를 캐시에 저장

* 쿼리 과정

  > zigispace.net 도메인을 클라이언트가 DNS에 쿼리

  	1. DNS 서버는 루트 DNS에 다시 쿼리

  2. 루트 DNS 는 .net에 대한 정보를 관리하는 DNS 주소 정보를 DNS 서버에 응답
  3. 응답을 받은 DNS 서버는 .net을 관리하는 DNS 서버에 zigispace.net에 대해 쿼리
  4. .net을 관리하는 DNS 서버는 zigispace.net을 관리하는 DNS 관련 정보를 처음 DNS 서버에 응답
  5. DNS 서버는 마지막으로 zigispace.net을 관리하는 DNS에 쿼리하고 zigispace.net에 대한 최종 결과값을 받게됨

> 재귀적 쿼리 : 쿼리를 보낸 클라이언트에 서버가 최종 결괏값을 반환하는 서버 중심 쿼리
>
> 반복적 쿼리 : 최종값을 받을 때까지 클라이언트에서 쿼리를 계속 진행하는 방식

### 마스터와 슬레이브

> DNS 서버는 마스터(Master, Primary) 서버와 슬레이브(Slave, Secondary) 서버로 나눌 수 있음

* 마스터 서버가 우선 순위가 더 높지 않고 두 서버 모두 도메인 쿼리에 응답
* 도메인에 대한 존(zone) 파일을 직접 관리하는지 여부
  * 마스터 : 존 파일을 직접 생성해 도메인 관련 정보를 관리
  * 슬레이브 : 마스터에 만들어진 존파일을 복제 (영역 전송)



### GSLB

> DNS에서 동일한 레코드 이름으로 서로 다른 IP 주소를 동시에 설정할 수 있음. 이렇게 설정하면 도메인 질의에 따라 응답받는 IP 주소를 나누어 로드밸런싱 할 수 있음. 이것을 DNS 로드 밸런싱이라고 함

* DNS 서버는 특정 서비스에 문제가 있을 때 이것을 감지하지 못함 
* GSLB는 이런 문제점을 해결해 도메인을 이용한 로드밸런싱 구현
* 도메인 질의에 응답 + 연결된 서비스가 정상적인지 헬스 체크 수행



### GSLB 동작 방식

1. 사용자가 web.zigispace.net에 젒ㄱ하기 위해 DNS에 질의
2. LDNS느