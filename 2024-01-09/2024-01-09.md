# 2024-01-09

## 네트워크

#### WAF(Web Application Firewall)

* 웹 서버를 보호하는 전용 보안 장비
* IDS/IPS 장비보다 범용성이 떨어지지만 웹 프로토콜에 대해서는 더 세밀히 방어 가능
* 장비나 소프트웨어 형태로 제공됨
  * 전용 네트워크 장비
  * 웹 서버의 플러그인
  * ADC 플러그인
  * 프록시 장비 플러그인

* 프로식 서버와 같이 패킷을 데이터 형태로 조합해 처리 
  * 회피 공격이 어려움
  * 데이터의 일부를 수정, 추가하는 기능 수행 가능

#### 샌드박스

* APT의 공격을 방어하는 장비

1. 악성 코드를 샌드박스 시스템 안에서 직접 실행시킴
2. 행동을 모니터링해 그파일들의 악성 코드 여부를 판별

* APT(Advanced Persistent Threat) : 해커들이 목표를 공격하고 접근하는데 성공한 후에도 그들이 계속해서 대상을 공격하고, 시스템에 남아있어 계속적으로 정보를 훔치거나 다른 악의적인 활동을 수행하는 것
* ATA(Advanced Target Attack) : 해커들이 특정한 목표물에 맞춰 매우 정교하게 계획된 공격을 실행하는 것

#### NAC(Network Access Control)

* 네트워크에 접속할 때 인가된 사용자만 내부망에 접속할 수 있고 인가받기 저이나 승인에 실패한 사용자는 접속할 수 없도록 제어하는 기술

#### 제어

* NAC와 비슷하나 IP를 할당하고 추적하는 솔루션이 추가
* 정확히 의도된 IP 할당이 아니면 정상적으로 네트워크 사용하지 못하게 함

#### 접근 통제

> 내부 네트워크를 보호하는 데 사용되는 특수한  형태의 컴퓨터나 서버

* 서버나 데이터베이스에 대한 직접적인 접근을 막고 작업 추적 및 감사를 할 수 있는 접근 통제 솔루션

* 대부분 Bastion Host 기반으로 구현

  * Bastion Host

  * > 외부 네트워크와 내부 네트워크 사이에 위치하여, 외부에서 내부로 들어오는 접속을 관리하고 제어하는 역할

  1. 서버 접근을 위한 모든 통신은 Bastion Host를 통해서만 가능
  2. 서버 호스트의 방화벽에 Bastion Host에서 출발한 통신만 허용하고 다른 통신은 모두 방어

<br/>

### 방화벽

#### 방화벽의 정의

> 네트워크 중간에 위치해 해당 장비를 통과하는 트래픽을 사전에 주어진 정책 조건에 맞추어 허용하거나 차단하는 장비

* 일반적으로 네트워크 3, 4 계층에서 동작하며 세션을 인지하는 상태 기반 엔진(Stateful Packet Inspection, SPI)으로 동작
  * Stateful Packet Inspection 
    * 패킷을 분석하는 방법 중 하나
    * 각 패킷이 네트워크를 통과할 때, 패킷의 헤더와 데이터를 검사하여 패킷이 유효한지, 예상대로 도착하는지 등을 확인
      * Stateful
        * 이 기술이 상태를 추적한다는 것을 나타냄
        * 이전 패킷들의 정보를 기반으로 현재 패킷을 평가한다는 것을 의미

#### 초기 방화벽

* 스티이트리스(Stateless) 또는 패킷 필터(Packet Filter) 방화벽

  > SPI 를 갖고 있지 않아 패킷의 인과 관계를 확인하지 못해 장비에 등록된 정책만으로 단순히 패킷을 필터링



#### IPS, IDS

* IDS(Intrusion Detection System) : 공격자가 시스템을 해킹할 때 탐지를 목적으로 개발된 시스템
  * '방어'보다 '탐지'에 초점을 맞춤
  * 공격에 직접 개입하거나 방어하지 않고 트래픽을 복제해 검토하고 침입 여부를 판별
* IPS(Intrusion Prevention System) : 공격이 발견되면 직접 차단하는 능력을 갖춤
* 최근 용어가 IPS로 통일

* IPS는 두 가지 형태로 존재
  * Host based IPS
    * 보호 대상 : 개별 컴퓨터나 서버와 같은 단일 호스트
    * 작동 방식 : 시스템의 로그 및 활동을 감시하고, 악성 코드나 비인가된 접근 시도 등을 감지하여 차단하거나 경고
  * Network based IPS
    * 보호 대상 : 네트워크 자체, 데이터가 흐르는 네트워크 인프라
    * 작동 방식 : 네트워크 트래픽을 모니터링하고, 패킷 분석과 트래픽 패턴을 검사하여 악성 행위나 공격을 탐지하고 차단

#### 동작 방식

##### 1. 패턴 매칭 방식

> 기존 공격이나 취약점을 통해 공격 방식에 대한 데이터베이스를 습득하고 그 최신 내용을 유지하다가 공격을  파악하는 방식 (시그니처 방식, 데이터베이스 방식)

##### 2. 어노말리 공격 방어

* 프로파일 어노말리
  * 관리자가 정해놓은 기준이나 IPS 장비가 모니터링해 정해진 기준과 다른 행위가 일어나면 공격으로 판단
  * 향후 DDoS 방어 장비로 진화
* 프로토컬 어노말리
  * 잘 알려진 포트와 실제로 통신하는 프로토콜이 다를 때, 이것을 파악해 적절히 제어하는 기법



### 로드 밸런서

* VIP(Virtual IP) : 서비스를 위해 사용되는 IP 주소, 서비스 IP 주소라고도 함

* Real IP : 각 서버의 실제 IP

* 가상 IP에 실제 서버들이 바인딩 됨
  * 사용자가 VIP로 서비스를 요청하면 해당 VIP에 연결된 리얼 IP로 해당 요청을 전달

#### 헬스 체크

1. ICMP
   * ICMP(ping)로 헬스 체크를 수행하는 방법
   * 단순히 살아 있는지 여부만 체크하는 방법으로 잘 사용하지 않음

2. TCP 서비스 포트
   * SYN, ACK, FIN 을 통해 서버의 서비스 포트를 확인하는 방법
     1. 리얼 IP의 포트로 SYN을 보냄
     2. 해당 IP를 가진 서버로부터 SYN, ACK를 받음
     3. 다시 ACK로 응답하고 FIN을 보내 헬스 체크 종료
3. TCP 서비스 포트 : Half Open
   * 헬스 체크로 인한 부하를 줄이거나 정상적인 종료 방식보다 빨리 헬스 체크 세션을 끊기 위한 방식
     1. SYN을 보냄
     2. SYN, ACK를 발음
     3. ACK 대신 RST를 보내 세션을 끊음

4. HTTP 상태 코드

